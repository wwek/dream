<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DRM Schedule Plugin - Demo</title>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- FontAwesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Plugin CSS -->
    <link rel="stylesheet" href="drm_schedule.css">

    <style>
        /* Demoé¡µé¢æ ·å¼ */
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #1a1a1a;
            color: #ecf0f1;
        }

        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .demo-header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 30px;
            text-align: center;
        }

        .demo-header h1 {
            margin: 0 0 10px 0;
            color: #ecf0f1;
            font-size: 32px;
        }

        .demo-header p {
            margin: 0;
            color: #bdc3c7;
            font-size: 16px;
        }

        .demo-controls {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .demo-controls h2 {
            margin: 0 0 15px 0;
            font-size: 18px;
            color: #3498db;
        }

        .demo-button {
            padding: 10px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: all 0.2s ease;
        }

        .demo-button:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }

        .demo-button.secondary {
            background: #95a5a6;
        }

        .demo-button.secondary:hover {
            background: #7f8c8d;
        }

        .demo-info {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .demo-info h3 {
            margin: 0 0 10px 0;
            font-size: 16px;
            color: #3498db;
        }

        .demo-info ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .demo-info li {
            margin: 5px 0;
            color: #bdc3c7;
        }

        .demo-console {
            background: #000;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            color: #00ff00;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .demo-console .log-entry {
            margin: 2px 0;
            padding: 2px 0;
            border-bottom: 1px solid #333;
        }

        .demo-console .log-info { color: #3498db; }
        .demo-console .log-success { color: #2ecc71; }
        .demo-console .log-warning { color: #f39c12; }
        .demo-console .log-error { color: #e74c3c; }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .feature-card {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .feature-card h3 {
            margin: 0 0 10px 0;
            font-size: 18px;
            color: #3498db;
        }

        .feature-card p {
            margin: 0;
            color: #bdc3c7;
            line-height: 1.6;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.active {
            background: #2ecc71;
            box-shadow: 0 0 10px rgba(46, 204, 113, 0.5);
        }

        .status-indicator.inactive {
            background: #95a5a6;
        }

        /* æ¨¡æ‹ŸOpenWebRXèƒŒæ™¯ */
        .owrx-simulation {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
            z-index: -1;
        }
    </style>
</head>
<body>
    <div class="owrx-simulation"></div>

    <div class="demo-container">
        <div class="demo-header">
            <h1>ğŸ“» DRM Broadcast Schedule Plugin</h1>
            <p>çº¯å‰ç«¯çŸ­æ³¢å¹¿æ’­è®¡åˆ’è¡¨æ’ä»¶æ¼”ç¤º / Pure Frontend DRM Schedule Demo</p>
        </div>

        <div class="demo-controls">
            <h2>ğŸ® æ§åˆ¶é¢æ¿ / Control Panel</h2>
            <button class="demo-button" onclick="openSchedule()">
                ğŸ“º æ‰“å¼€è®¡åˆ’è¡¨ / Open Schedule
            </button>
            <button class="demo-button secondary" onclick="closeSchedule()">
                âœ• å…³é—­è®¡åˆ’è¡¨ / Close Schedule
            </button>
            <button class="demo-button" onclick="reloadData()">
                ğŸ”„ é‡æ–°åŠ è½½æ•°æ® / Reload Data
            </button>
            <button class="demo-button" onclick="switchToByService()">
                ğŸ“‹ æŒ‰æœåŠ¡åˆ†ç»„ / By Service
            </button>
            <button class="demo-button" onclick="switchToByTime()">
                ğŸ• æŒ‰æ—¶é—´æ’åº / By Time
            </button>
            <button class="demo-button" onclick="switchToByFreq()">
                ğŸ“¡ æŒ‰é¢‘ç‡æ’åº / By Frequency
            </button>
        </div>

        <div class="demo-info">
            <h3>â„¹ï¸ æ’ä»¶ä¿¡æ¯ / Plugin Info</h3>
            <ul>
                <li><span class="status-indicator active"></span>æ’ä»¶çŠ¶æ€: <span id="plugin-status">æœªåŠ è½½</span></li>
                <li><span class="status-indicator inactive"></span>ç”µå°æ•°é‡: <span id="station-count">0</span></li>
                <li><span class="status-indicator inactive"></span>æ•°æ®æ¥æº: <span id="data-source">æœªçŸ¥</span></li>
                <li><span class="status-indicator inactive"></span>å½“å‰UTCæ—¶é—´: <span id="current-utc">--:--</span></li>
            </ul>
        </div>

        <div class="feature-grid">
            <div class="feature-card">
                <h3>ğŸ¯ ä¸‰ç§æ˜¾ç¤ºæ¨¡å¼</h3>
                <p>
                    â€¢ æŒ‰æœåŠ¡åˆ†ç»„ - ç›¸åŒç”µå°åˆå¹¶æ˜¾ç¤º<br>
                    â€¢ æŒ‰æ—¶é—´æ’åº - æœ€æ—©æ’­å‡ºçš„åœ¨å‰<br>
                    â€¢ æŒ‰é¢‘ç‡æ’åº - ä½é¢‘åˆ°é«˜é¢‘æ’åˆ—
                </p>
            </div>

            <div class="feature-card">
                <h3>ğŸ”´ å®æ—¶çŠ¶æ€</h3>
                <p>
                    â€¢ ç»¿è‰²é«˜äº®æ˜¾ç¤ºæ­£åœ¨æ’­å‡ºçš„èŠ‚ç›®<br>
                    â€¢ æ¯åˆ†é’Ÿè‡ªåŠ¨åˆ·æ–°çŠ¶æ€<br>
                    â€¢ UTCæ—¶é—´è½´å‡†ç¡®æ˜¾ç¤º
                </p>
            </div>

            <div class="feature-card">
                <h3>ğŸŒ åŒé‡æ•°æ®æº</h3>
                <p>
                    â€¢ ä¼˜å…ˆåŠ è½½è¿œç¨‹æ•°æ® (KiwiSDR)<br>
                    â€¢ å¤±è´¥æ—¶è‡ªåŠ¨é™çº§åˆ°æœ¬åœ°ç¼“å­˜<br>
                    â€¢ æ”¯æŒCJSONæ ¼å¼ (å¸¦æ³¨é‡Š)
                </p>
            </div>

            <div class="feature-card">
                <h3>ğŸ›ï¸ ç‚¹å‡»è°ƒè°</h3>
                <p>
                    â€¢ ç‚¹å‡»ä»»æ„æ—¶é—´å—å³å¯è°ƒè°<br>
                    â€¢ è‡ªåŠ¨è½¬æ¢é¢‘ç‡å•ä½ (kHz â†’ Hz)<br>
                    â€¢ å¤šç§è°ƒè°APIå…¼å®¹
                </p>
            </div>
        </div>

        <div class="demo-info">
            <h3>ğŸ“Š æ§åˆ¶å°æ—¥å¿— / Console Log</h3>
            <div class="demo-console" id="console-log">
                <div class="log-entry log-info">[Demo] ç­‰å¾…ç”¨æˆ·æ“ä½œ...</div>
            </div>
        </div>
    </div>

    <script>
    // ========== æ¨¡æ‹Ÿ OpenWebRX ç¯å¢ƒ ==========

    // 1. æ¨¡æ‹Ÿ Plugins å¯¹è±¡
    window.Plugins = {
        drm_schedule: {
            _version: 1.0
        },
        load: function(type, name) {
            console.log('[Demo] Plugins.load called:', type, name);
            addLog('info', '[Demo] åŠ è½½æ’ä»¶: ' + type + '/' + name);
        }
    };

    // 2. æ¨¡æ‹Ÿ demodulatorPanel (ç”¨äºè°ƒè°åŠŸèƒ½)
    window.demodulatorPanel = {
        getDemodulator: function() {
            return {
                get_modulation: function() {
                    return 'drm';  // æ¨¡æ‹ŸDRMæ¨¡å¼
                },
                set_modulation: function(mode) {
                    console.log('[Demo] Set modulation to:', mode);
                    addLog('info', '[Demo] åˆ‡æ¢æ¨¡å¼: ' + mode);
                },
                set_offset_frequency: function(offset) {
                    console.log('[Demo] Set offset:', offset, 'Hz');
                    addLog('info', '[Demo] è®¾ç½®offset: ' + offset + ' Hz');
                },
                set_center_freq: function(freqHz) {
                    console.log('[Demo] Tuning to:', freqHz, 'Hz');
                    addLog('success', '[Demo] è°ƒè°åˆ°: ' + (freqHz / 1000) + ' kHz');
                }
            };
        }
    };

    // 3. æ¨¡æ‹Ÿ set_center_freq å…¨å±€å‡½æ•°
    window.set_center_freq = function(freqHz) {
        console.log('[Demo] Global tune function called:', freqHz, 'Hz');
        addLog('success', '[Demo] å…¨å±€è°ƒè°: ' + (freqHz / 1000) + ' kHz');
    };

    // 4. æ¨¡æ‹Ÿ .openwebrx-modes å…ƒç´ ï¼ˆç”¨äºæ’å…¥æŒ‰é’®ï¼‰
    $(document).ready(function() {
        if ($('.openwebrx-modes').length === 0) {
            $('body').append('<div class="openwebrx-modes" style="display:none;"></div>');
        }
    });

    // ========== åˆå§‹åŒ–æ’ä»¶ ==========
    $(document).ready(function() {
        addLog('info', '[Demo] é¡µé¢åŠ è½½å®Œæˆ');
        addLog('info', '[Demo] æ¨¡æ‹ŸOpenWebRXç¯å¢ƒ...');
        addLog('success', '[Demo] Pluginså¯¹è±¡å·²åˆ›å»º');
        addLog('success', '[Demo] demodulatorPanelå·²æ¨¡æ‹Ÿ');

        addLog('info', '[Demo] åŠ è½½DRM Scheduleæ’ä»¶...');

        // åŠ¨æ€åŠ è½½æ’ä»¶è„šæœ¬
        $.getScript('drm_schedule.js').done(function() {
            addLog('success', '[Demo] æ’ä»¶è„šæœ¬åŠ è½½æˆåŠŸ');

            // æ£€æŸ¥æ’ä»¶å¯¹è±¡
            if (typeof Plugins.drm_schedule !== 'undefined') {
                addLog('info', '[Demo] åˆå§‹åŒ–DRM Scheduleæ’ä»¶...');

                // ä½¿ç”¨æ­£ç¡®çš„åˆå§‹åŒ–æ–¹æ³•ï¼ˆä¼šè‡ªåŠ¨åŠ è½½jQuery Modalï¼‰
                Plugins.drm_schedule.init();

                addLog('success', '[Demo] æ’ä»¶åˆå§‹åŒ–å·²å¯åŠ¨');
                updatePluginStatus('åŠ è½½ä¸­...');

                // ç­‰å¾…æ’ä»¶å®Œå…¨åˆå§‹åŒ–åæ›´æ–°çŠ¶æ€
                setTimeout(function() {
                    if (typeof DRM_Schedule !== 'undefined' && DRM_Schedule.stations) {
                        updatePluginStatus('å·²åŠ è½½');
                        addLog('success', '[Demo] æ’ä»¶åˆå§‹åŒ–å®Œæˆ');
                    }
                }, 2000);
            } else {
                addLog('error', '[Demo] æ’ä»¶å¯¹è±¡æœªæ‰¾åˆ°');
                updatePluginStatus('åŠ è½½å¤±è´¥');
            }
        }).fail(function(jqxhr, settings, exception) {
            addLog('error', '[Demo] æ’ä»¶è„šæœ¬åŠ è½½å¤±è´¥: ' + exception);
            updatePluginStatus('åŠ è½½å¤±è´¥');
        });

        // ç›‘å¬æ’ä»¶äº‹ä»¶
        $(document).on('drm:loaded', function(event, data) {
            addLog('success', '[Event] æ•°æ®åŠ è½½å®Œæˆ');
            updateStationCount(data.stations ? data.stations.length : 0);

            // Demoæ¨¡å¼ï¼šæ•°æ®åŠ è½½å®Œæˆåè‡ªåŠ¨æ‰“å¼€å¼¹çª—å±•ç¤º
            setTimeout(function() {
                addLog('info', '[Demo] è‡ªåŠ¨æ‰“å¼€å¼¹çª—è¿›è¡Œæ¼”ç¤º...');
                openSchedule();
            }, 500);
        });

        $(document).on('drm:tune', function(event, data) {
            addLog('info', '[Event] è°ƒè°è¯·æ±‚: ' + (data.frequency / 1000) + ' kHz');
        });

        // æ›´æ–°UTCæ—¶é—´
        updateUTCTime();
        setInterval(updateUTCTime, 1000);

        // ç›‘å¬æ’ä»¶çŠ¶æ€
        setInterval(checkPluginStatus, 2000);
    });

    // æ§åˆ¶å‡½æ•°
    function openSchedule() {
        if (typeof DRM_Schedule !== 'undefined' && typeof DRM_Schedule.showPanel === 'function') {
            // æ£€æŸ¥jQuery Modalæ˜¯å¦åŠ è½½
            if (typeof $.modal === 'undefined') {
                addLog('warning', '[Demo] jQuery Modalåº“å°šæœªåŠ è½½ï¼Œè¯·ç¨åå†è¯•...');
                setTimeout(openSchedule, 500);
                return;
            }

            DRM_Schedule.showPanel();
            addLog('info', '[Demo] æ‰“å¼€è®¡åˆ’è¡¨é¢æ¿');
        } else {
            addLog('error', '[Demo] æ’ä»¶æœªåˆå§‹åŒ–ï¼Œè¯·ç­‰å¾…åŠ è½½å®Œæˆ');
        }
    }

    function closeSchedule() {
        if (typeof DRM_Schedule !== 'undefined') {
            DRM_Schedule.hidePanel();
            addLog('info', '[Demo] å…³é—­è®¡åˆ’è¡¨é¢æ¿');
        }
    }

    function reloadData() {
        if (typeof DRM_Schedule !== 'undefined') {
            DRM_Schedule.loadStations();
            addLog('info', '[Demo] é‡æ–°åŠ è½½æ•°æ®');
        }
    }

    function switchToByService() {
        if (typeof DRM_Schedule !== 'undefined') {
            DRM_Schedule.switchMode('BY_SVC');
            addLog('info', '[Demo] åˆ‡æ¢åˆ°æŒ‰æœåŠ¡åˆ†ç»„æ¨¡å¼');
        }
    }

    function switchToByTime() {
        if (typeof DRM_Schedule !== 'undefined') {
            DRM_Schedule.switchMode('BY_TIME');
            addLog('info', '[Demo] åˆ‡æ¢åˆ°æŒ‰æ—¶é—´æ’åºæ¨¡å¼');
        }
    }

    function switchToByFreq() {
        if (typeof DRM_Schedule !== 'undefined') {
            DRM_Schedule.switchMode('BY_FREQ');
            addLog('info', '[Demo] åˆ‡æ¢åˆ°æŒ‰é¢‘ç‡æ’åºæ¨¡å¼');
        }
    }

    // å·¥å…·å‡½æ•°
    function addLog(type, message) {
        var console = $('#console-log');
        var typeClass = 'log-' + type;
        var timestamp = new Date().toLocaleTimeString();

        var entry = $('<div>')
            .addClass('log-entry')
            .addClass(typeClass)
            .text('[' + timestamp + '] ' + message);

        console.append(entry);

        // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
        console.scrollTop(console[0].scrollHeight);

        // é™åˆ¶æ—¥å¿—æ¡æ•°
        var entries = console.find('.log-entry');
        if (entries.length > 50) {
            entries.first().remove();
        }
    }

    function updatePluginStatus(status) {
        $('#plugin-status').text(status);
    }

    function updateStationCount(count) {
        $('#station-count').text(count);
    }

    function updateUTCTime() {
        var now = new Date();
        var hours = now.getUTCHours().toString().padStart(2, '0');
        var minutes = now.getUTCMinutes().toString().padStart(2, '0');
        var seconds = now.getUTCSeconds().toString().padStart(2, '0');
        $('#current-utc').text(hours + ':' + minutes + ':' + seconds);
    }

    function checkPluginStatus() {
        if (typeof DRM_Schedule !== 'undefined') {
            // æ›´æ–°ç”µå°æ•°é‡
            if (DRM_Schedule.stations) {
                updateStationCount(DRM_Schedule.stations.length);
            }

            // æ›´æ–°æ•°æ®æº
            var dataSource = 'æœ¬åœ°ç¼“å­˜';
            if (DRM_Schedule.stations && DRM_Schedule.stations.length > 0) {
                // ç®€å•åˆ¤æ–­: å¦‚æœæœ‰å¾ˆå¤šç”µå°,å¯èƒ½æ˜¯è¿œç¨‹æ•°æ®
                if (DRM_Schedule.stations.length > 50) {
                    dataSource = 'KiwiSDRè¿œç¨‹';
                }
            }
            $('#data-source').text(dataSource);
        }
    }

    // åŸç”Ÿconsole.logæ‹¦æˆª
    var originalLog = console.log;
    console.log = function() {
        originalLog.apply(console, arguments);

        var message = Array.prototype.slice.call(arguments).join(' ');
        if (message.indexOf('[DRM Schedule]') !== -1) {
            var type = 'info';
            if (message.indexOf('error') !== -1 || message.indexOf('failed') !== -1) {
                type = 'error';
            } else if (message.indexOf('success') !== -1 || message.indexOf('loaded') !== -1) {
                type = 'success';
            } else if (message.indexOf('warn') !== -1) {
                type = 'warning';
            }
            addLog(type, message.replace('[DRM Schedule] ', ''));
        }
    };

    var originalWarn = console.warn;
    console.warn = function() {
        originalWarn.apply(console, arguments);
        var message = Array.prototype.slice.call(arguments).join(' ');
        if (message.indexOf('[DRM Schedule]') !== -1) {
            addLog('warning', message.replace('[DRM Schedule] ', ''));
        }
    };

    var originalError = console.error;
    console.error = function() {
        originalError.apply(console, arguments);
        var message = Array.prototype.slice.call(arguments).join(' ');
        if (message.indexOf('[DRM Schedule]') !== -1) {
            addLog('error', message.replace('[DRM Schedule] ', ''));
        }
    };
    </script>
</body>
</html>
